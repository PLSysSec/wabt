;;; TOOL: run-spec-wasm2c
;;; ARGS*: --enable-threads
;; Adhoc tests for wait/notify not covered by the spec suite. Test wait timeout behavior.

(module
  ;; Import 1 page (64Kib) of shared memory.
  (import "spectest" "memory" (memory 10 100 shared))

  (func (export "test_wait") (result i32)
    (memory.atomic.wait32
          (i32.const 4)            ;; atomic address
          (i32.const 0)            ;; expected value
          (i64.const 1000000000))  ;; timeout after 1 seconds
  )
)

(assert_return (invoke "test_wait") (i32.const 2)) ;; timed out

(;; STDOUT ;;;
1/1 tests passed.
;;; STDOUT ;;)
